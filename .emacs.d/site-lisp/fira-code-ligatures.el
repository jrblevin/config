;;; fira-code-ligatures.el: Support ligatures in Fira Code font -*-emacs-lisp-*-

;; Regular expressions should be grouped by length and expressed in
;; order of length.
;; https://github.com/tonsky/FiraCode/wiki/Setting-up-Emacs
(let ((alist
       '(
         ;; ! -> !==, !!!, !!, !=
         (33 . ".\\(?:\\(?:==\\|!!\\)\\|[!=]\\)")
         ;; # -> ####, ###, #_(, ##, #(, #?, #[, #_, #{
         (35 . ".\\(?:###\\|##\\|_(\\|[#(?[_{]\\)")
         ;; $ -> $>
         (36 . ".\\(?:>\\)")
         ;; % -> %%%, %%
         (37 . ".\\(?:\\(?:%%\\)\\|%\\)")
         ;; & -> &&&, &&
         (38 . ".\\(?:\\(?:&&\\)\\|&\\)")
         ;; * -> *
         (42 . ".\\(?:\\(?:\\*\\*/\\)\\|\\(?:\\*[*/]\\)\\|[*/>]\\)")
         ;; + -> +++, ++, +>
         (43 . ".\\(?:\\(?:\\+\\+\\)\\|[+>]\\)")
         ;; - -> -->, ---, -<<, ->>, -<, ->, -}, -~, --
         (45 . ".\\(?:\\(?:-[>-]\\|<<\\|>>\\)\\|[<>}~-]\\)")
         ;; . -> ..., ..<, .., .=, .-
         (46 . ".\\(?:\\(?:\\.[.<]\\)\\|[.=-]\\)")
         ;; / -> /**, ///, /==, /*, //, /=, />
         (47 . ".\\(?:\\(?:\\*\\*\\|//\\|==\\)\\|[*/=>]\\)")
         ;; 0 -> 0xF
         (48 . ".\\(?:x[a-zA-Z]\\)")
         ;; : -> :::, ::, :=
         (58 . ".\\(?:::\\|[:=]\\)")
         ;; ; -> ;;;, ;;
         (59 . ".\\(?:;;\\|;\\)")
         ;; < -> <!--, <~~, <->, <$>, <*>, <+>, <--, <<<, <<=, <<-, <=<, <==, <=>, <|>,
         ;;      <*, <$, <+, <~, </, <<, <=, <>, <|, <-
         (60 . ".\\(?:\\(?:!--\\)\\|\\(?:~~\\|->\\|\\$>\\|\\*>\\|\\+>\\|--\\|<[<=-]\\|=[<=>]\\||>\\)\\|[*$+~/<=>|-]\\)")
         ;; = -> =/=, =:=, =<<, ===, ==>, =>>, =<, ==, =>, =~
         (61 . ".\\(?:\\(?:/=\\|:=\\|<<\\|=[=>]\\|>>\\)\\|[<=>~]\\)")
         ;; > -> >=>, >>=, >>>, >>-, >=, >>, >-
         (62 . ".\\(?:\\(?:=>\\|>[=>-]\\)\\|[=>-]\\)")
         ;; ? -> ???, ?:, ?=, ??
         (63 . ".\\(?:\\(\\?\\?\\)\\|[=?]\\)")
         ;; [ -> []
         (91 . ".\\(?:]\\)")
         ;; \ -> \\\, \\
         (92 . ".\\(?:\\(?:\\\\\\\\\\)\\|\\\\\\)")
         ;; ^ -> ^=
         (94 . ".\\(?:=\\)")
         ;; w -> www
         (119 . ".\\(?:ww\\)")
         ;; {, -> {-
         (123 . ".\\(?:-\\)")
         ;; | -> ||=, |||, |=, |>, ||
         (124 . ".\\(?:\\(?:|[=|]\\)\\|[=>|]\\)")
         ;; ~ -> ~~>, ~~~, ~~>, ~~=, ~@, ~~, ~-
         (126 . ".\\(?:~>\\|~~\\|[>=@~-]\\)")
         )))
  (dolist (char-regexp alist)
    (set-char-table-range composition-function-table (car char-regexp)
                          `([,(cdr char-regexp) 0 font-shape-gstring]))))

(provide 'fira-code-ligatures)
